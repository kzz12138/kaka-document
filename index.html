<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å’”å’”å•è¯æœ¬ | Kaka Vocab</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase Imports for Firestore -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Expose Firebase utilities globally for the Babel script to use
        window.Firebase = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore, doc, getDoc, addDoc, setDoc, deleteDoc, onSnapshot, collection, query, orderBy };
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        peach: {
                            50: '#fff0f3',
                            100: '#ffe4e9',
                            200: '#fcc2d7',
                            300: '#faa2c1',
                            400: '#f783ac',
                            500: '#f06595', // Primary
                            600: '#e64980',
                        },
                        cream: '#fff9e6', // Background
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #fff9e6; font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .card-shadow { box-shadow: 0 4px 15px -2px rgba(240, 101, 149, 0.15); }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,228,233, 0.5); }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #faa2c1; border-radius: 20px; }
        
        /* Quiz Card Flip effect */
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        @media (min-width: 640px) {
            @keyframes slide-up {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        }
        .animate-slide-up { animation: slide-up 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        
        // --- Firebase Setup Global Variables (Must be defined) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- Utility Hooks and Components ---
        
        // Custom Toast Hook
        const useToast = () => {
            const [toast, setToast] = useState(null);
            
            const showToast = useCallback((message, type = 'info', duration = 3000) => {
                setToast({ message, type });
                setTimeout(() => setToast(null), duration);
            }, []);

            const Toast = () => toast ? (
                <div className="fixed bottom-4 left-1/2 -translate-x-1/2 z-[100] p-3 rounded-xl shadow-lg text-sm font-medium transition-all duration-300 animate-slide-up"
                    style={{ 
                        backgroundColor: toast.type === 'error' ? '#fee2e2' : (toast.type === 'success' ? '#d1fae5' : '#fff0f3'),
                        color: toast.type === 'error' ? '#dc2626' : (toast.type === 'success' ? '#059669' : '#e64980'),
                        border: '1px solid ' + (toast.type === 'error' ? '#fca5a5' : (toast.type === 'success' ? '#a7f3d0' : '#fcc2d7'))
                    }}
                >
                    {toast.message}
                </div>
            ) : null;

            return { showToast, Toast };
        };

        // Custom Modal Hook for Confirmations
        const useModal = () => {
            const [modalState, setModalState] = useState({ isOpen: false, message: '', onConfirm: () => {} });

            const showConfirmModal = useCallback((message, onConfirm) => {
                setModalState({ isOpen: true, message, onConfirm: () => {
                    onConfirm();
                    setModalState({ ...modalState, isOpen: false });
                }});
            }, [modalState]);

            const closeModal = () => setModalState({ ...modalState, isOpen: false });

            const Modal = () => modalState.isOpen ? (
                <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-xs rounded-2xl p-6 shadow-2xl animate-slide-up border border-peach-200">
                        <p className="text-gray-700 text-lg mb-6 text-center">{modalState.message}</p>
                        <div className="flex justify-between gap-3">
                            <button onClick={closeModal} className="flex-1 bg-gray-100 text-gray-600 py-2.5 rounded-xl font-medium hover:bg-gray-200 transition">å–æ¶ˆ</button>
                            <button onClick={modalState.onConfirm} className="flex-1 bg-peach-500 text-white py-2.5 rounded-xl font-bold hover:bg-peach-600 transition">ç¡®è®¤</button>
                        </div>
                    </div>
                </div>
            ) : null;

            return { showConfirmModal, Modal };
        };

        // --- Icon Components ---
        const Icons = {
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Sort: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>,
            Book: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Volume: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>,
        };

        const App = () => {
            const [words, setWords] = useState([]);
            const [view, setView] = useState('list');
            const [sortMethod, setSortMethod] = useState('date');
            
            // Firebase State
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Input State
            const [english, setEnglish] = useState('');
            const [chinese, setChinese] = useState('');
            const [pos, setPos] = useState('');
            const [pronunciation, setPronunciation] = useState('');
            const [isFormOpen, setIsFormOpen] = useState(false);

            // Quiz State
            const [quizStage, setQuizStage] = useState('setup');
            const [quizQueue, setQuizQueue] = useState([]);
            const [currentCardIndex, setCurrentCardIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            // Toast and Modal Hooks (replacing alert/confirm)
            const { showToast, Toast } = useToast();
            const { showConfirmModal, Modal } = useModal();

            // 1. Firebase Initialization and Authentication
            useEffect(() => {
                if (!window.Firebase || !firebaseConfig.apiKey) {
                    console.error("Firebase is not initialized. Check imports or config.");
                    setIsAuthReady(true); // Treat as ready but unauthenticated if setup fails
                    return;
                }
                
                const { initializeApp, getAuth, getFirestore, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window.Firebase;
                
                const app = initializeApp(firebaseConfig);
                const firestore = getFirestore(app);
                const authentication = getAuth(app);

                setDb(firestore);
                setAuth(authentication);

                const unsubscribe = onAuthStateChanged(authentication, (user) => {
                    if (user) {
                        setUserId(user.uid);
                    } else {
                        // Sign in if no user is found
                        const signIn = async () => {
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(authentication, initialAuthToken);
                                } else {
                                    await signInAnonymously(authentication);
                                }
                            } catch (error) {
                                console.error("Firebase Auth Error:", error);
                            }
                        };
                        signIn();
                    }
                    setIsAuthReady(true);
                });

                return () => unsubscribe();
            }, []);

            // 2. Firestore Real-time Listener (onSnapshot)
            useEffect(() => {
                if (!isAuthReady || !db) return;

                // Mandatory Public Collection Path: /artifacts/{appId}/public/data/{your_collection_name}
                const collectionPath = `artifacts/${appId}/public/data/vocab_words`;
                const q = window.Firebase.collection(db, collectionPath);

                const unsubscribe = window.Firebase.onSnapshot(q, (snapshot) => {
                    const newWords = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setWords(newWords);
                }, (error) => {
                    console.error("Firestore Snapshot Error:", error);
                    showToast("æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¿æ¥ã€‚", 'error');
                });

                return () => unsubscribe();
            }, [isAuthReady, db, appId, showToast]);


            const addWord = async (e) => {
                e.preventDefault();
                if (!english || !chinese) return;
                if (!db) {
                    showToast("æ•°æ®åº“æœªè¿æ¥ï¼Œè¯·ç¨å€™ã€‚", 'error');
                    return;
                }

                try {
                    const collectionPath = `artifacts/${appId}/public/data/vocab_words`;
                    await window.Firebase.addDoc(window.Firebase.collection(db, collectionPath), {
                        english: english.trim(),
                        chinese: chinese.trim(),
                        pos: pos.trim(),
                        pronunciation: pronunciation.trim(),
                        dateAdded: Date.now(),
                        userId: userId || 'anonymous'
                    });
                    
                    showToast("å•è¯æ·»åŠ æˆåŠŸï¼", 'success');
                    setEnglish('');
                    setChinese('');
                    setPos('');
                    setPronunciation('');
                    setIsFormOpen(false);
                } catch (error) {
                    console.error("Error adding word:", error);
                    showToast("æ·»åŠ å•è¯å¤±è´¥ã€‚", 'error');
                }
            };

            const deleteWord = (id) => {
                if (!db) {
                    showToast("æ•°æ®åº“æœªè¿æ¥ã€‚", 'error');
                    return;
                }
                
                showConfirmModal('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•è¯å—ï¼Ÿ', async () => {
                    try {
                        const docPath = `artifacts/${appId}/public/data/vocab_words/${id}`;
                        await window.Firebase.deleteDoc(window.Firebase.doc(db, docPath));
                        showToast("å•è¯å·²åˆ é™¤ã€‚", 'success');
                    } catch (error) {
                        console.error("Error deleting word:", error);
                        showToast("åˆ é™¤å¤±è´¥ã€‚", 'error');
                    }
                });
            };

            // Sorting Logic
            const sortedWords = useMemo(() => {
                let list = [...words];
                if (sortMethod === 'date') {
                    // Newest first (using dateAdded from Firestore)
                    list.sort((a, b) => b.dateAdded - a.dateAdded);
                } else {
                    // A-Z
                    list.sort((a, b) => a.english.localeCompare(b.english));
                }
                return list;
            }, [words, sortMethod]);

            // Quiz Logic
            const startQuiz = (mode) => {
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                let queue = [];

                if (words.length === 0) {
                    showToast("å•è¯æœ¬æ˜¯ç©ºçš„ï¼Œå¿«å»æ·»åŠ å§ï¼", 'error');
                    return;
                }

                if (mode === 'yesterday') {
                    queue = words.filter(w => (now - w.dateAdded) <= oneDay);
                } else if (mode === '3days') {
                    queue = words.filter(w => (now - w.dateAdded) <= (oneDay * 3));
                } else if (mode === 'random10') {
                    // Shuffle and take 10
                    queue = [...words].sort(() => 0.5 - Math.random()).slice(0, 10);
                }
                
                if (queue.length === 0) {
                    showToast("è¿™ä¸ªèŒƒå›´å†…æ²¡æœ‰å•è¯å“¦ï¼Œè¯•è¯•å…¶ä»–èŒƒå›´å§ï¼", 'error');
                    return;
                }

                setQuizQueue(queue);
                setCurrentCardIndex(0);
                setIsFlipped(false);
                setQuizStage('playing');
            };

            const nextCard = () => {
                if (currentCardIndex < quizQueue.length - 1) {
                    setIsFlipped(false);
                    // Add a slight delay for better visual transition (optional)
                    setTimeout(() => setCurrentCardIndex(prev => prev + 1), 150);
                } else {
                    setQuizStage('result');
                }
            };

            const playAudio = (text) => {
                // Check if browser supports speech synthesis
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    speechSynthesis.speak(utterance);
                } else {
                    showToast("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾ã€‚", 'info');
                }
            };

            // --- Render Components ---

            const renderHeader = () => (
                <div className="sticky top-0 z-50 glass px-4 py-3 mb-4 flex justify-between items-center shadow-sm">
                    <h1 className="text-xl font-bold text-peach-600 tracking-tight flex items-center gap-2">
                        ğŸ“¸ å’”å’”å•è¯æœ¬
                    </h1>
                    <div className="flex bg-peach-100 rounded-full p-1 scale-90 origin-right">
                        <button 
                            onClick={() => { setView('list'); setQuizStage('setup'); }}
                            className={`px-4 py-1.5 rounded-full text-sm font-medium transition-all ${view === 'list' ? 'bg-white text-peach-600 shadow-sm' : 'text-peach-400 hover:text-peach-500'}`}
                        >
                            <span className="flex items-center gap-1"><Icons.Book /> åˆ—è¡¨</span>
                        </button>
                        <button 
                            onClick={() => setView('quiz')}
                            className={`px-4 py-1.5 rounded-full text-sm font-medium transition-all ${view === 'quiz' ? 'bg-white text-peach-600 shadow-sm' : 'text-peach-400 hover:text-peach-500'}`}
                        >
                            <span className="flex items-center gap-1"><Icons.Zap /> æŠ½å¡</span>
                        </button>
                    </div>
                </div>
            );

            const renderLoadingState = () => (
                <div className="text-center py-20 text-peach-400 flex flex-col items-center">
                    <Icons.Lock />
                    <p className="mt-2 font-medium">
                        {isAuthReady ? 'åŠ è½½å•è¯ä¸­...' : 'æ­£åœ¨è¿æ¥æ•°æ®åº“...'}
                    </p>
                </div>
            );

            const renderWordList = () => {
                if (!isAuthReady || !db) return renderLoadingState();

                return (
                    <div className="px-3 pb-24 max-w-md mx-auto">
                        {/* Controls */}
                        <div className="flex justify-between items-center mb-3 px-1">
                            <span className="text-peach-400 text-xs font-medium bg-white px-2 py-1 rounded-lg border border-peach-100 shadow-sm">æ€»è®¡: {words.length}</span>
                            <button 
                                onClick={() => setSortMethod(prev => prev === 'date' ? 'alpha' : 'date')}
                                className="flex items-center gap-1 text-xs bg-white px-2 py-1 rounded-lg border border-peach-200 text-peach-500 hover:bg-peach-50 transition"
                            >
                                <Icons.Sort /> {sortMethod === 'date' ? 'æŒ‰æ—¥æœŸæ’åº' : 'æŒ‰ A-Z æ’åº'}
                            </button>
                        </div>

                        {/* Add Button */}
                        <button 
                            onClick={() => setIsFormOpen(true)}
                            className="w-full mb-4 py-2.5 border-2 border-dashed border-peach-300 rounded-xl text-peach-400 font-medium hover:bg-peach-50 hover:border-peach-400 transition flex justify-center items-center gap-2 text-sm"
                        >
                            <Icons.Plus /> æ·»åŠ æ–°å•è¯
                        </button>

                        {/* List */}
                        <div className="space-y-2.5">
                            {sortedWords.map(word => (
                                <div key={word.id} className="bg-white p-3 rounded-xl border border-peach-100 card-shadow relative group hover:border-peach-300 transition-all">
                                    
                                    {/* Top Row: English & Date */}
                                    <div className="flex justify-between items-start mb-1">
                                        <div className="flex items-center gap-2">
                                            <h3 className="text-lg font-bold text-gray-800 leading-tight">{word.english}</h3>
                                            <button onClick={() => playAudio(word.english)} className="text-peach-300 hover:text-peach-500 transition scale-90"><Icons.Volume /></button>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span className="text-[10px] font-bold text-peach-500 bg-peach-50 px-2 py-0.5 rounded-md border border-peach-100 shadow-sm">
                                                {new Date(word.dateAdded).toLocaleDateString()}
                                            </span>
                                            <button 
                                                onClick={() => deleteWord(word.id)}
                                                className="text-gray-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition scale-90"
                                            >
                                                <Icons.Trash />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Bottom Row: Chinese & Meta */}
                                    <div className="flex justify-between items-end">
                                        <p className="text-gray-600 font-medium text-sm truncate max-w-[70%]">{word.chinese}</p>
                                        
                                        <div className="flex items-center gap-1.5 text-xs">
                                            {word.pos && <span className="bg-gray-50 text-gray-400 px-1.5 py-0.5 rounded border border-gray-100">{word.pos}</span>}
                                            {word.pronunciation && <span className="font-mono text-gray-400">[{word.pronunciation}]</span>}
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {sortedWords.length === 0 && (
                                <div className="text-center py-10 text-peach-300">
                                    <p>è¿˜æ²¡æœ‰å•è¯å“¦ï¼Œå¿«å»æ·»åŠ å§ï¼âœ¨</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderAddForm = () => {
                if (!isFormOpen) return null;
                return (
                    <div className="fixed inset-0 bg-black/20 backdrop-blur-sm z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold text-gray-700">æ·»åŠ æ–°å•è¯</h2>
                                <button onClick={() => setIsFormOpen(false)} className="text-gray-400 hover:text-gray-600"><Icons.X /></button>
                            </div>
                            <form onSubmit={addWord} className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-peach-500 uppercase mb-1">è‹±æ–‡ (å¿…å¡«)</label>
                                    <input autoFocus value={english} onChange={e => setEnglish(e.target.value)} className="w-full bg-peach-50 border-none rounded-xl p-3 text-lg font-medium focus:ring-2 focus:ring-peach-300 outline-none placeholder-peach-200" placeholder="Apple" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-peach-500 uppercase mb-1">ä¸­æ–‡ (å¿…å¡«)</label>
                                    <input value={chinese} onChange={e => setChinese(e.target.value)} className="w-full bg-peach-50 border-none rounded-xl p-3 text-lg font-medium focus:ring-2 focus:ring-peach-300 outline-none placeholder-peach-200" placeholder="è‹¹æœ" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-400 uppercase mb-1">è¯æ€§ (é€‰å¡«)</label>
                                        <input value={pos} onChange={e => setPos(e.target.value)} className="w-full bg-gray-50 border-none rounded-xl p-3 text-sm focus:ring-2 focus:ring-gray-200 outline-none" placeholder="n." />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-400 uppercase mb-1">éŸ³æ ‡ (é€‰å¡«)</label>
                                        <input value={pronunciation} onChange={e => setPronunciation(e.target.value)} className="w-full bg-gray-50 border-none rounded-xl p-3 text-sm focus:ring-2 focus:ring-gray-200 outline-none" placeholder="/.../" />
                                    </div>
                                </div>
                                <button type="submit" className="w-full bg-peach-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-peach-200 hover:bg-peach-600 transition mt-4">
                                    âœ¨ ç¡®è®¤æ·»åŠ 
                                </button>
                            </form>
                        </div>
                    </div>
                );
            };

            const renderQuiz = () => {
                if (!isAuthReady || !db) return renderLoadingState();

                if (quizStage === 'setup') {
                    return (
                        <div className="px-6 py-10 max-w-md mx-auto space-y-4">
                            <h2 className="text-2xl font-bold text-center text-gray-700 mb-8">å‡†å¤‡å¥½å¤ä¹ äº†å—ï¼Ÿ</h2>
                            
                            <button onClick={() => startQuiz('yesterday')} className="w-full bg-white p-6 rounded-2xl border border-peach-100 shadow-sm hover:shadow-md hover:border-peach-300 transition text-left group">
                                <div className="text-lg font-bold text-gray-800 group-hover:text-peach-500">ğŸ“… å¤ä¹ æœ€è¿‘ 24 å°æ—¶ ({words.filter(w => (Date.now() - w.dateAdded) <= 24 * 60 * 60 * 1000).length} ä¸ª)</div>
                                <div className="text-gray-400 text-sm mt-1">åªçœ‹æœ€è¿‘ä¸€å¤©æ·»åŠ çš„å•è¯</div>
                            </button>

                            <button onClick={() => startQuiz('3days')} className="w-full bg-white p-6 rounded-2xl border border-peach-100 shadow-sm hover:shadow-md hover:border-peach-300 transition text-left group">
                                <div className="text-lg font-bold text-gray-800 group-hover:text-peach-500">ğŸ—“ï¸ å¤ä¹ æœ€è¿‘ 3 å¤© ({words.filter(w => (Date.now() - w.dateAdded) <= 3 * 24 * 60 * 60 * 1000).length} ä¸ª)</div>
                                <div className="text-gray-400 text-sm mt-1">å·©å›ºçŸ­æœŸè®°å¿†</div>
                            </button>

                            <button onClick={() => startQuiz('random10')} className="w-full bg-white p-6 rounded-2xl border border-peach-100 shadow-sm hover:shadow-md hover:border-peach-300 transition text-left group">
                                <div className="text-lg font-bold text-gray-800 group-hover:text-peach-500">ğŸ² éšæœºæŠ½æŸ¥ 10 ä¸ª (æ€»æ•°: {words.length})</div>
                                <div className="text-gray-400 text-sm mt-1">ä»æ‰€æœ‰å•è¯ä¸­éšæœºæŠ½å–</div>
                            </button>
                        </div>
                    );
                }

                if (quizStage === 'result') {
                    return (
                        <div className="px-6 py-20 text-center max-w-md mx-auto">
                            <div className="text-6xl mb-4">ğŸ‰</div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">å¤ä¹ å®Œæˆï¼</h2>
                            <p className="text-gray-500 mb-8">ä»Šå¤©åˆè¿›æ­¥äº†ä¸€ç‚¹ç‚¹å“¦ã€‚</p>
                            <button onClick={() => setQuizStage('setup')} className="bg-peach-500 text-white px-8 py-3 rounded-full font-bold shadow-lg shadow-peach-200 hover:bg-peach-600 transition">
                                å†æ¥ä¸€æ¬¡
                            </button>
                        </div>
                    );
                }

                // Playing State
                const currentWord = quizQueue[currentCardIndex];
                
                return (
                    <div className="px-4 py-6 max-w-md mx-auto h-[calc(100vh-100px)] flex flex-col">
                        <div className="flex justify-between text-sm text-peach-400 font-bold uppercase mb-4 px-2">
                            <span>Quiz Mode</span>
                            <span>{currentCardIndex + 1} / {quizQueue.length}</span>
                        </div>

                        {/* Flashcard */}
                        <div 
                            className="flex-1 perspective-1000 relative cursor-pointer group" 
                            onClick={() => setIsFlipped(!isFlipped)}
                        >
                            <div className={`w-full h-full relative transition-all duration-500 preserve-3d`} style={{ transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)' }}>
                                
                                {/* Front */}
                                <div className="absolute inset-0 backface-hidden bg-white rounded-3xl shadow-xl border-b-4 border-peach-200 flex flex-col items-center justify-center p-8">
                                    <span className="text-6xl mb-6">ğŸ§ </span>
                                    <h2 className="text-4xl font-bold text-gray-800 text-center">{currentWord.english}</h2>
                                    <p className="text-peach-400 mt-4 text-sm animate-pulse">ç‚¹å‡»ç¿»çœ‹ç­”æ¡ˆ</p>
                                </div>

                                {/* Back */}
                                <div className="absolute inset-0 backface-hidden bg-peach-50 rounded-3xl shadow-xl border-b-4 border-peach-300 flex flex-col items-center justify-center p-8" style={{ transform: 'rotateY(180deg)' }}>
                                    <h3 className="text-2xl font-bold text-peach-600 mb-2">{currentWord.chinese}</h3>
                                    <div className="flex items-center gap-2 mb-6">
                                        <span className="bg-white px-2 py-1 rounded text-sm text-gray-500 border border-peach-100">{currentWord.pos || 'N/A'}</span>
                                        <span className="font-mono text-gray-500">[{currentWord.pronunciation || '-'}]</span>
                                        <button onClick={(e) => { e.stopPropagation(); playAudio(currentWord.english); }} className="p-1 bg-white rounded-full text-peach-500 hover:scale-110 transition"><Icons.Volume /></button>
                                    </div>
                                    <div className="w-full flex gap-3 mt-auto">
                                        {/* Next button only shows on back of card */}
                                        <button onClick={(e) => { e.stopPropagation(); nextCard(); }} className="flex-1 bg-peach-500 text-white py-3 rounded-xl font-bold shadow-md shadow-peach-200 hover:bg-peach-600 transition">
                                            {currentCardIndex < quizQueue.length - 1 ? 'ä¸‹ä¸€ä¸ª' : 'å®Œæˆ'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="h-8"></div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-cream">
                    {renderHeader()}
                    
                    {view === 'list' && renderWordList()}
                    {view === 'quiz' && renderQuiz()}
                    {renderAddForm()}
                    <Toast />
                    <Modal />
                    {userId && <div className="fixed bottom-0 right-0 p-1 text-[10px] text-gray-400 bg-cream/70 border-t border-l border-peach-100 rounded-tl-lg truncate max-w-full">
                        User ID: {userId}
                    </div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
